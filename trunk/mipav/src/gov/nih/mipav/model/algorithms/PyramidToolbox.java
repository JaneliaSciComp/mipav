package gov.nih.mipav.model.algorithms;

import java.io.IOException;
import java.util.Collections;
import java.util.Vector;

import gov.nih.mipav.model.file.FileIO;
import gov.nih.mipav.model.structures.ModelImage;
import gov.nih.mipav.model.structures.ModelStorageBase;
import gov.nih.mipav.view.MipavUtil;
import gov.nih.mipav.view.ViewUserInterface;

public class PyramidToolbox extends AlgorithmBase {
	
	/**
	 * 
	 This code is a port of the MATLAB Pyramid Toolbox
	===========================  matlabPyrTools ============================

			This package contains some MatLab tools for multi-scale image
			processing.  Briefly, the tools include:
			  - Recursive multi-scale image decompositions (pyramids), including
			    Laplacian pyramids, QMFs, Wavelets, and steerable pyramids.  These
			    operate on 1D or 2D signals of arbitrary dimension.  Data
			    structures are compatible with the MatLab wavelet toolbox.
			  - Fast 2D convolution routines, with subsampling and boundary-handling.
			  - Fast point-operations, histograms, histogram-matching.
			  - Fast synthetic image generation: sine gratings, zone plates, fractals, etc.
			  - Display routines for images and pyramids.  These include several
			    auto-scaling options, rounding to integer zoom factors to avoid 
			    resampling artifacts, and useful labeling (dimensions and gray-range).

			The package is available as a gnu-zipped UNIX "tar" file, accessible
			from the web page:   http://www.cns.nyu.edu/~lcv/software.html
			
			
    The MIT License (MIT)

	Copyright (c) 2015 LabForComputationalVision
	
	Permission is hereby granted, free of charge, to any person obtaining a copy
	of this software and associated documentation files (the "Software"), to deal
	in the Software without restriction, including without limitation the rights
	to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	copies of the Software, and to permit persons to whom the Software is
	furnished to do so, subject to the following conditions:
	
	The above copyright notice and this permission notice shall be included in all
	copies or substantial portions of the Software.
	
	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
	SOFTWARE.
	*/


	
	public PyramidToolbox() {
		
	}
	
	public void runAlgorithm() {
		
	}
	
        // [PYR, INDICES, STEERMTX, HARMONICS] = buildSpyr(IM, HEIGHT, FILTFILE, EDGES)
		
		// Construct a steerable pyramid on matrix IM.  Convolutions are
		// done with spatial filters.
		
		// HEIGHT (optional) specifies the number of pyramid levels to build. Default
		// is maxPyrHt(size(IM),size(FILT)). 
		// You can also specify 'auto' to use this value.
		
		// FILTFILE (optional) should be a string referring to an m-file that
		// returns the rfilters.  (examples: 'sp0Filters', 'sp1Filters',
		// 'sp3Filters','sp5Filters'.  default = 'sp1Filters'). EDGES specifies
		// edge-handling, and defaults to 'reflect1' (see corrDn).
		
		// PYR is a vector containing the N pyramid subbands, ordered from fine
		// to coarse.  INDICES is an Nx2 matrix containing the sizes of
		// each subband.  This is compatible with the MatLab Wavelet toolbox.
		// See the function STEER for a description of STEERMTX and HARMONICS.

		// Eero Simoncelli, 6/96.
		// See http://www.cis.upenn.edu/~eero/steerpyr.html for more
		// information about the Steerable Pyramid image decomposition.
	    // filtfile default sp1Filters
	    // edges default = reflect1

		public void buildSpyr(Vector<Integer>pyr, Vector<Integer>pind, Vector<int[]> harmonics, Vector<double[][]>steermtx, double im[][],
				int ht, String filtfile, String edges) {
			int i,r,c;
            double hi0filt[][] = null;
            double lo0filt[][] = null;
            double lofilt[][] = null;
            double bfiltstranspose[][] = null;
            double bfilts[][] = null;
            // Steerable pyramid filters.  Transform described  in:
        	
        	// @INPROCEEDINGS{Simoncelli95b,
        	//	TITLE = "The Steerable Pyramid: A Flexible Architecture for
        	//		 Multi-Scale Derivative Computation",
        	//	AUTHOR = "E P Simoncelli and W T Freeman",
        	//	BOOKTITLE = "Second Int'l Conf on Image Processing",
        	//	ADDRESS = "Washington, DC", MONTH = "October", YEAR = 1995 }
        	
        	// Filter kernel design described in:
        	//
        	// @INPROCEEDINGS{Karasaridis96,
        	//	TITLE = "A Filter Design Technique for 
        	//		Steerable Pyramid Image Transforms",
        	//	AUTHOR = "A Karasaridis and E P Simoncelli",
        	//	BOOKTITLE = "ICASSP",	ADDRESS = "Atlanta, GA",
        	//	MONTH = "May",	YEAR = 1996 }

        	// Eero Simoncelli, 6/96.
            if (filtfile.equalsIgnoreCase("sp0Filters")) {
            	harmonics.add(new int[] { 0 });

            	lo0filt = new double[][] {
            	{-4.514000e-04, -1.137100e-04, -3.725800e-04, -3.743860e-03, -3.725800e-04, -1.137100e-04, -4.514000e-04},
            	{-1.137100e-04, -6.119520e-03 ,-1.344160e-02, -7.563200e-03, -1.344160e-02, -6.119520e-03, -1.137100e-04},
            	{-3.725800e-04, -1.344160e-02, 6.441488e-02, 1.524935e-01, 6.441488e-02, -1.344160e-02, -3.725800e-04}, 
            	{-3.743860e-03, -7.563200e-03, 1.524935e-01, 3.153017e-01, 1.524935e-01, -7.563200e-03, -3.743860e-03}, 
            	{-3.725800e-04, -1.344160e-02, 6.441488e-02, 1.524935e-01, 6.441488e-02, -1.344160e-02, -3.725800e-04}, 
            	{-1.137100e-04, -6.119520e-03, -1.344160e-02, -7.563200e-03, -1.344160e-02, -6.119520e-03, -1.137100e-04}, 
            	{-4.514000e-04, -1.137100e-04, -3.725800e-04, -3.743860e-03, -3.725800e-04, -1.137100e-04, -4.514000e-04}};

            	lofilt = new double[][]{
            	{-2.257000e-04, -8.064400e-04, -5.686000e-05, 8.741400e-04, -1.862800e-04, -1.031640e-03, -1.871920e-03, 
            	-1.031640e-03, -1.862800e-04, 8.741400e-04, -5.686000e-05, -8.064400e-04, -2.257000e-04}, 
            	{-8.064400e-04, 1.417620e-03, -1.903800e-04, -2.449060e-03, -4.596420e-03, -7.006740e-03, -6.948900e-03,
            	-7.006740e-03, -4.596420e-03, -2.449060e-03, -1.903800e-04, 1.417620e-03, -8.064400e-04}, 
            	{-5.686000e-05, -1.903800e-04, -3.059760e-03, -6.401000e-03, -6.720800e-03, -5.236180e-03, -3.781600e-03,
            	-5.236180e-03, -6.720800e-03, -6.401000e-03, -3.059760e-03, -1.903800e-04, -5.686000e-05}, 
            	{8.741400e-04, -2.449060e-03, -6.401000e-03, -5.260020e-03, 3.938620e-03, 1.722078e-02, 2.449600e-02,
            	1.722078e-02, 3.938620e-03, -5.260020e-03, -6.401000e-03, -2.449060e-03, 8.741400e-04}, 
            	{-1.862800e-04, -4.596420e-03, -6.720800e-03, 3.938620e-03, 3.220744e-02, 6.306262e-02, 7.624674e-02,
            	6.306262e-02, 3.220744e-02, 3.938620e-03, -6.720800e-03, -4.596420e-03, -1.862800e-04}, 
            	{-1.031640e-03, -7.006740e-03, -5.236180e-03, 1.722078e-02, 6.306262e-02, 1.116388e-01, 1.348999e-01,
            	1.116388e-01, 6.306262e-02, 1.722078e-02, -5.236180e-03, -7.006740e-03, -1.031640e-03}, 
            	{-1.871920e-03, -6.948900e-03, -3.781600e-03, 2.449600e-02, 7.624674e-02, 1.348999e-01, 1.576508e-01,
            	1.348999e-01, 7.624674e-02, 2.449600e-02, -3.781600e-03, -6.948900e-03, -1.871920e-03}, 
            	{-1.031640e-03, -7.006740e-03, -5.236180e-03, 1.722078e-02, 6.306262e-02, 1.116388e-01, 1.348999e-01,
            	1.116388e-01, 6.306262e-02, 1.722078e-02, -5.236180e-03, -7.006740e-03, -1.031640e-03}, 
            	{-1.862800e-04, -4.596420e-03, -6.720800e-03, 3.938620e-03, 3.220744e-02, 6.306262e-02, 7.624674e-02,
            	6.306262e-02, 3.220744e-02, 3.938620e-03, -6.720800e-03, -4.596420e-03, -1.862800e-04},
            	{8.741400e-04, -2.449060e-03, -6.401000e-03, -5.260020e-03, 3.938620e-03, 1.722078e-02, 2.449600e-02,
            	1.722078e-02, 3.938620e-03, -5.260020e-03, -6.401000e-03, -2.449060e-03, 8.741400e-04}, 
            	{-5.686000e-05, -1.903800e-04, -3.059760e-03, -6.401000e-03, -6.720800e-03, -5.236180e-03, -3.781600e-03,
            	-5.236180e-03, -6.720800e-03, -6.401000e-03, -3.059760e-03, -1.903800e-04, -5.686000e-05}, 
            	{-8.064400e-04, 1.417620e-03, -1.903800e-04, -2.449060e-03, -4.596420e-03, -7.006740e-03, -6.948900e-03,
            	-7.006740e-03, -4.596420e-03, -2.449060e-03, -1.903800e-04, 1.417620e-03, -8.064400e-04}, 
            	{-2.257000e-04, -8.064400e-04, -5.686000e-05, 8.741400e-04, -1.862800e-04, -1.031640e-03, -1.871920e-03,
            	-1.031640e-03, -1.862800e-04, 8.741400e-04, -5.686000e-05, -8.064400e-04, -2.257000e-04}}; 

            	steermtx.add(new double[][] {{ 1.000000 }});

            	hi0filt = new double[][] {
            	{5.997200e-04, -6.068000e-05, -3.324900e-04, -3.325600e-04, -2.406600e-04, -3.325600e-04, -3.324900e-04, -6.068000e-05, 5.997200e-04},
            	{-6.068000e-05, 1.263100e-04, 4.927100e-04, 1.459700e-04, -3.732100e-04, 1.459700e-04, 4.927100e-04, 1.263100e-04, -6.068000e-05}, 
            	{-3.324900e-04, 4.927100e-04, -1.616650e-03, -1.437358e-02, -2.420138e-02, -1.437358e-02, -1.616650e-03, 4.927100e-04, -3.324900e-04}, 
            	{-3.325600e-04, 1.459700e-04, -1.437358e-02, -6.300923e-02, -9.623594e-02, -6.300923e-02, -1.437358e-02, 1.459700e-04, -3.325600e-04}, 
            	{-2.406600e-04, -3.732100e-04, -2.420138e-02, -9.623594e-02, 8.554893e-01, -9.623594e-02, -2.420138e-02, -3.732100e-04, -2.406600e-04}, 
            	{-3.325600e-04, 1.459700e-04, -1.437358e-02, -6.300923e-02, -9.623594e-02, -6.300923e-02, -1.437358e-02, 1.459700e-04, -3.325600e-04}, 
            	{-3.324900e-04, 4.927100e-04, -1.616650e-03, -1.437358e-02, -2.420138e-02, -1.437358e-02, -1.616650e-03, 4.927100e-04, -3.324900e-04}, 
            	{-6.068000e-05, 1.263100e-04, 4.927100e-04, 1.459700e-04, -3.732100e-04, 1.459700e-04, 4.927100e-04, 1.263100e-04, -6.068000e-05}, 
            	{5.997200e-04, -6.068000e-05, -3.324900e-04, -3.325600e-04, -2.406600e-04, -3.325600e-04, -3.324900e-04, -6.068000e-05, 5.997200e-04 }};

            	bfiltstranspose = new double[][] {
            	{-9.066000e-05, -1.738640e-03, -4.942500e-03, -7.889390e-03, -1.009473e-02, -7.889390e-03, -4.942500e-03, -1.738640e-03, -9.066000e-05,
            	-1.738640e-03, -4.625150e-03, -7.272540e-03, -7.623410e-03, -9.091950e-03, -7.623410e-03, -7.272540e-03, -4.625150e-03, -1.738640e-03,
            	-4.942500e-03, -7.272540e-03, -2.129540e-02, -2.435662e-02, -3.487008e-02, -2.435662e-02, -2.129540e-02, -7.272540e-03, -4.942500e-03,
            	-7.889390e-03, -7.623410e-03, -2.435662e-02, -1.730466e-02, -3.158605e-02, -1.730466e-02, -2.435662e-02, -7.623410e-03, -7.889390e-03,
            	-1.009473e-02, -9.091950e-03, -3.487008e-02, -3.158605e-02, 9.464195e-01, -3.158605e-02, -3.487008e-02, -9.091950e-03, -1.009473e-02,
            	-7.889390e-03, -7.623410e-03, -2.435662e-02, -1.730466e-02, -3.158605e-02, -1.730466e-02, -2.435662e-02, -7.623410e-03, -7.889390e-03,
            	-4.942500e-03, -7.272540e-03, -2.129540e-02, -2.435662e-02, -3.487008e-02, -2.435662e-02, -2.129540e-02, -7.272540e-03, -4.942500e-03,
            	-1.738640e-03, -4.625150e-03, -7.272540e-03, -7.623410e-03, -9.091950e-03, -7.623410e-03, -7.272540e-03, -4.625150e-03, -1.738640e-03,
            	-9.066000e-05, -1.738640e-03, -4.942500e-03, -7.889390e-03, -1.009473e-02, -7.889390e-03, -4.942500e-03, -1.738640e-03, -9.066000e-05}};
            	bfilts = new double[bfiltstranspose[0].length][bfiltstranspose.length];
				for (r = 0; r < bfilts.length; r++) {
					for (c = 0; c < bfilts[0].length; c++) {
						bfilts[r][c] = bfiltstranspose[c][r];
					}
				}
	
            }
            else if (filtfile.equalsIgnoreCase("sp1Filters")) {
            	harmonics.add(new int[] { 1 });

            	// filters only contain first harmonic.
            	steermtx.add(new double[][] {{1,0},{0,1}});

            	lo0filt = new double[][] {
            	{-8.701000e-05, -1.354280e-03, -1.601260e-03, -5.033700e-04, 2.524010e-03, -5.033700e-04, -1.601260e-03, -1.354280e-03, -8.701000e-05},
            	{-1.354280e-03, 2.921580e-03, 7.522720e-03, 8.224420e-03, 1.107620e-03, 8.224420e-03, 7.522720e-03, 2.921580e-03, -1.354280e-03}, 
            	{-1.601260e-03, 7.522720e-03, -7.061290e-03, -3.769487e-02, -3.297137e-02, -3.769487e-02, -7.061290e-03, 7.522720e-03, -1.601260e-03},  
            	{-5.033700e-04, 8.224420e-03, -3.769487e-02, 4.381320e-02, 1.811603e-01, 4.381320e-02, -3.769487e-02, 8.224420e-03, -5.033700e-04}, 
            	{2.524010e-03, 1.107620e-03, -3.297137e-02, 1.811603e-01, 4.376250e-01, 1.811603e-01, -3.297137e-02, 1.107620e-03, 2.524010e-03},  
            	{-5.033700e-04, 8.224420e-03, -3.769487e-02, 4.381320e-02, 1.811603e-01, 4.381320e-02, -3.769487e-02, 8.224420e-03, -5.033700e-04},  
            	{-1.601260e-03, 7.522720e-03, -7.061290e-03, -3.769487e-02, -3.297137e-02, -3.769487e-02, -7.061290e-03, 7.522720e-03, -1.601260e-03},  
            	{-1.354280e-03, 2.921580e-03, 7.522720e-03, 8.224420e-03, 1.107620e-03, 8.224420e-03, 7.522720e-03, 2.921580e-03, -1.354280e-03},  
            	{-8.701000e-05, -1.354280e-03, -1.601260e-03, -5.033700e-04, 2.524010e-03, -5.033700e-04, -1.601260e-03, -1.354280e-03, -8.701000e-05}};

            	lofilt = new double[][] {
            	{-4.350000e-05, 1.207800e-04, -6.771400e-04, -1.243400e-04, -8.006400e-04, -1.597040e-03, -2.516800e-04, -4.202000e-04, 1.262000e-03,
            		-4.202000e-04, -2.516800e-04, -1.597040e-03, -8.006400e-04, -1.243400e-04, -6.771400e-04, 1.207800e-04, -4.350000e-05},
            	{1.207800e-04, 4.460600e-04, -5.814600e-04, 5.621600e-04, -1.368800e-04, 2.325540e-03, 2.889860e-03, 4.287280e-03, 5.589400e-03,
            		4.287280e-03, 2.889860e-03, 2.325540e-03, -1.368800e-04, 5.621600e-04, -5.814600e-04, 4.460600e-04, 1.207800e-04},
            	{-6.771400e-04, -5.814600e-04, 1.460780e-03, 2.160540e-03, 3.761360e-03, 3.080980e-03, 4.112200e-03, 2.221220e-03, 5.538200e-04,
            		2.221220e-03, 4.112200e-03, 3.080980e-03, 3.761360e-03, 2.160540e-03, 1.460780e-03, -5.814600e-04, -6.771400e-04},
            	{-1.243400e-04, 5.621600e-04, 2.160540e-03, 3.175780e-03, 3.184680e-03, -1.777480e-03, -7.431700e-03, -9.056920e-03, -9.637220e-03,
            		-9.056920e-03, -7.431700e-03, -1.777480e-03, 3.184680e-03, 3.175780e-03, 2.160540e-03, 5.621600e-04, -1.243400e-04},
            	{-8.006400e-04, -1.368800e-04, 3.761360e-03, 3.184680e-03, -3.530640e-03, -1.260420e-02, -1.884744e-02, -1.750818e-02, -1.648568e-02,
            		-1.750818e-02, -1.884744e-02, -1.260420e-02, -3.530640e-03, 3.184680e-03, 3.761360e-03, -1.368800e-04, -8.006400e-04},
            	{-1.597040e-03, 2.325540e-03, 3.080980e-03, -1.777480e-03, -1.260420e-02, -2.022938e-02, -1.109170e-02, 3.955660e-03, 1.438512e-02,
            		3.955660e-03, -1.109170e-02, -2.022938e-02, -1.260420e-02, -1.777480e-03, 3.080980e-03, 2.325540e-03, -1.597040e-03},
            	{-2.516800e-04, 2.889860e-03, 4.112200e-03, -7.431700e-03, -1.884744e-02, -1.109170e-02, 2.190660e-02, 6.806584e-02, 9.058014e-02,
            		6.806584e-02, 2.190660e-02, -1.109170e-02, -1.884744e-02, -7.431700e-03, 4.112200e-03, 2.889860e-03, -2.516800e-04},
            	{-4.202000e-04, 4.287280e-03, 2.221220e-03, -9.056920e-03, -1.750818e-02, 3.955660e-03, 6.806584e-02, 1.445500e-01, 1.773651e-01,
            		1.445500e-01, 6.806584e-02, 3.955660e-03, -1.750818e-02, -9.056920e-03, 2.221220e-03, 4.287280e-03, -4.202000e-04},
            	{1.262000e-03, 5.589400e-03, 5.538200e-04, -9.637220e-03, -1.648568e-02, 1.438512e-02, 9.058014e-02, 1.773651e-01, 2.120374e-01,
            		1.773651e-01, 9.058014e-02, 1.438512e-02, -1.648568e-02, -9.637220e-03, 5.538200e-04, 5.589400e-03, 1.262000e-03},
            	{-4.202000e-04, 4.287280e-03, 2.221220e-03, -9.056920e-03, -1.750818e-02, 3.955660e-03, 6.806584e-02, 1.445500e-01, 1.773651e-01,
            		1.445500e-01, 6.806584e-02, 3.955660e-03, -1.750818e-02, -9.056920e-03, 2.221220e-03, 4.287280e-03, -4.202000e-04},
            	{-2.516800e-04, 2.889860e-03, 4.112200e-03, -7.431700e-03, -1.884744e-02, -1.109170e-02, 2.190660e-02, 6.806584e-02, 9.058014e-02,
            		6.806584e-02, 2.190660e-02, -1.109170e-02, -1.884744e-02, -7.431700e-03, 4.112200e-03, 2.889860e-03, -2.516800e-04},
            	{-1.597040e-03, 2.325540e-03, 3.080980e-03, -1.777480e-03, -1.260420e-02, -2.022938e-02, -1.109170e-02, 3.955660e-03, 1.438512e-02,
            		3.955660e-03, -1.109170e-02, -2.022938e-02, -1.260420e-02, -1.777480e-03, 3.080980e-03, 2.325540e-03, -1.597040e-03},
            	{-8.006400e-04, -1.368800e-04, 3.761360e-03, 3.184680e-03, -3.530640e-03, -1.260420e-02, -1.884744e-02, -1.750818e-02, -1.648568e-02,
            		-1.750818e-02, -1.884744e-02, -1.260420e-02, -3.530640e-03, 3.184680e-03, 3.761360e-03, -1.368800e-04, -8.006400e-04},
            	{-1.243400e-04, 5.621600e-04, 2.160540e-03, 3.175780e-03, 3.184680e-03, -1.777480e-03, -7.431700e-03, -9.056920e-03, -9.637220e-03,
            		-9.056920e-03, -7.431700e-03, -1.777480e-03, 3.184680e-03, 3.175780e-03, 2.160540e-03, 5.621600e-04, -1.243400e-04},
            	{-6.771400e-04, -5.814600e-04, 1.460780e-03, 2.160540e-03, 3.761360e-03, 3.080980e-03, 4.112200e-03, 2.221220e-03, 5.538200e-04,
            		2.221220e-03, 4.112200e-03, 3.080980e-03, 3.761360e-03, 2.160540e-03, 1.460780e-03, -5.814600e-04, -6.771400e-04},
            	{1.207800e-04, 4.460600e-04, -5.814600e-04, 5.621600e-04, -1.368800e-04, 2.325540e-03, 2.889860e-03, 4.287280e-03, 5.589400e-03,
            		4.287280e-03, 2.889860e-03, 2.325540e-03, -1.368800e-04, 5.621600e-04, -5.814600e-04, 4.460600e-04, 1.207800e-04},
            	{-4.350000e-05, 1.207800e-04, -6.771400e-04, -1.243400e-04, -8.006400e-04, -1.597040e-03, -2.516800e-04, -4.202000e-04, 1.262000e-03,
            		-4.202000e-04, -2.516800e-04, -1.597040e-03, -8.006400e-04, -1.243400e-04, -6.771400e-04, 1.207800e-04, -4.350000e-05}};

            	hi0filt = new double[][] {
            	{-9.570000e-04, -2.424100e-04, -1.424720e-03, -8.742600e-04, -1.166810e-03, -8.742600e-04, -1.424720e-03, -2.424100e-04, -9.570000e-04},
            	{-2.424100e-04, -4.317530e-03, 8.998600e-04, 9.156420e-03, 1.098012e-02, 9.156420e-03, 8.998600e-04, -4.317530e-03, -2.424100e-04},
            	{-1.424720e-03, 8.998600e-04, 1.706347e-02, 1.094866e-02, -5.897780e-03, 1.094866e-02, 1.706347e-02, 8.998600e-04, -1.424720e-03},
            	{-8.742600e-04, 9.156420e-03, 1.094866e-02, -7.841370e-02, -1.562827e-01, -7.841370e-02, 1.094866e-02, 9.156420e-03, -8.742600e-04},
            	{-1.166810e-03, 1.098012e-02, -5.897780e-03, -1.562827e-01, 7.282593e-01, -1.562827e-01, -5.897780e-03, 1.098012e-02, -1.166810e-03},
            	{-8.742600e-04, 9.156420e-03, 1.094866e-02, -7.841370e-02, -1.562827e-01, -7.841370e-02, 1.094866e-02, 9.156420e-03, -8.742600e-04},
            	{-1.424720e-03, 8.998600e-04, 1.706347e-02, 1.094866e-02, -5.897780e-03, 1.094866e-02, 1.706347e-02, 8.998600e-04, -1.424720e-03},
            	{-2.424100e-04, -4.317530e-03, 8.998600e-04, 9.156420e-03, 1.098012e-02, 9.156420e-03, 8.998600e-04, -4.317530e-03, -2.424100e-04},
            	{-9.570000e-04, -2.424100e-04, -1.424720e-03, -8.742600e-04, -1.166810e-03, -8.742600e-04, -1.424720e-03, -2.424100e-04, -9.570000e-04}};

            	bfiltstranspose = new double[][] {
            	{6.125880e-03, -8.052600e-03, -2.103714e-02, -1.536890e-02, -1.851466e-02, -1.536890e-02, -2.103714e-02, -8.052600e-03, 6.125880e-03,
            	-1.287416e-02, -9.611520e-03, 1.023569e-02, 6.009450e-03, 1.872620e-03, 6.009450e-03, 1.023569e-02, -9.611520e-03, -1.287416e-02,
            	-5.641530e-03, 4.168400e-03, -2.382180e-02, -5.375324e-02, -2.076086e-02, -5.375324e-02, -2.382180e-02, 4.168400e-03, -5.641530e-03,
            	-8.957260e-03, -1.751170e-03, -1.836909e-02, 1.265655e-01, 2.996168e-01, 1.265655e-01, -1.836909e-02, -1.751170e-03, -8.957260e-03,
            	0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00,
            	8.957260e-03, 1.751170e-03, 1.836909e-02, -1.265655e-01, -2.996168e-01, -1.265655e-01, 1.836909e-02, 1.751170e-03, 8.957260e-03,
            	5.641530e-03, -4.168400e-03, 2.382180e-02, 5.375324e-02, 2.076086e-02, 5.375324e-02, 2.382180e-02, -4.168400e-03, 5.641530e-03,
            	1.287416e-02, 9.611520e-03, -1.023569e-02, -6.009450e-03, -1.872620e-03, -6.009450e-03, -1.023569e-02, 9.611520e-03, 1.287416e-02,
            	-6.125880e-03, 8.052600e-03, 2.103714e-02, 1.536890e-02, 1.851466e-02, 1.536890e-02, 2.103714e-02, 8.052600e-03, -6.125880e-03},
            
            	{-6.125880e-03, 1.287416e-02, 5.641530e-03, 8.957260e-03, 0.000000e+00, -8.957260e-03, -5.641530e-03, -1.287416e-02, 6.125880e-03,
            	8.052600e-03, 9.611520e-03, -4.168400e-03, 1.751170e-03, 0.000000e+00, -1.751170e-03, 4.168400e-03, -9.611520e-03, -8.052600e-03,
            	2.103714e-02, -1.023569e-02, 2.382180e-02, 1.836909e-02, 0.000000e+00, -1.836909e-02, -2.382180e-02, 1.023569e-02, -2.103714e-02,
            	1.536890e-02, -6.009450e-03, 5.375324e-02, -1.265655e-01, 0.000000e+00, 1.265655e-01, -5.375324e-02, 6.009450e-03, -1.536890e-02,
            	1.851466e-02, -1.872620e-03, 2.076086e-02, -2.996168e-01, 0.000000e+00, 2.996168e-01, -2.076086e-02, 1.872620e-03, -1.851466e-02,
            	1.536890e-02, -6.009450e-03, 5.375324e-02, -1.265655e-01, 0.000000e+00, 1.265655e-01, -5.375324e-02, 6.009450e-03, -1.536890e-02,
            	2.103714e-02, -1.023569e-02, 2.382180e-02, 1.836909e-02, 0.000000e+00, -1.836909e-02, -2.382180e-02, 1.023569e-02, -2.103714e-02,
            	8.052600e-03, 9.611520e-03, -4.168400e-03, 1.751170e-03, 0.000000e+00, -1.751170e-03, 4.168400e-03, -9.611520e-03, -8.052600e-03,
            	-6.125880e-03, 1.287416e-02, 5.641530e-03, 8.957260e-03, 0.000000e+00, -8.957260e-03, -5.641530e-03, -1.287416e-02, 6.125880e-03}};
    			bfilts = new double[bfiltstranspose[0].length][bfiltstranspose.length];
				for (r = 0; r < bfilts.length; r++) {
					for (c = 0; c < bfilts[0].length; c++) {
						bfilts[r][c] = -bfiltstranspose[c][r];
					}
				}
	
            }
            else if (filtfile.equalsIgnoreCase("sp3Filters")) {
            	harmonics.add(new int[] {1, 3});

            	steermtx.add(new double[][] {
            	    {0.5000,    0.3536,         0,   -0.3536},
            	   {-0.0000,    0.3536,    0.5000,    0.3536},
            	    {0.5000,   -0.3536,         0,    0.3536},
            	   {-0.0000,    0.3536,   -0.5000,    0.3536}});

            	hi0filt = new double[][] {
            	{-4.0483998600E-4,  -6.2596000498E-4,  -3.7829999201E-5,  8.8387000142E-4,  1.5450799838E-3,  1.9235999789E-3,  2.0687500946E-3,
            	 2.0898699295E-3,  2.0687500946E-3,  1.9235999789E-3,  1.5450799838E-3,  8.8387000142E-4,  -3.7829999201E-5,  -6.2596000498E-4,  -4.0483998600E-4},
            	{-6.2596000498E-4,  -3.2734998967E-4,  7.7435001731E-4,  1.5874400269E-3,  2.1750701126E-3,  2.5626500137E-3,  2.2892199922E-3,
            	 1.9755100366E-3,  2.2892199922E-3,  2.5626500137E-3,  2.1750701126E-3,  1.5874400269E-3,  7.7435001731E-4,  -3.2734998967E-4,  -6.2596000498E-4},
            	{-3.7829999201E-5,  7.7435001731E-4,  1.1793200392E-3,  1.4050999889E-3,  2.2253401112E-3,  2.1145299543E-3,  3.3578000148E-4, 
            	 -8.3368999185E-4,  3.3578000148E-4,  2.1145299543E-3,  2.2253401112E-3,  1.4050999889E-3,  1.1793200392E-3,  7.7435001731E-4,  -3.7829999201E-5},
            	{8.8387000142E-4,  1.5874400269E-3,  1.4050999889E-3,  1.2960999738E-3,  -4.9274001503E-4,  -3.1295299996E-3,  -4.5751798898E-3,
            	 -5.1014497876E-3,  -4.5751798898E-3,  -3.1295299996E-3,  -4.9274001503E-4,  1.2960999738E-3,  1.4050999889E-3,  1.5874400269E-3, 8.8387000142E-4},
            	{1.5450799838E-3,  2.1750701126E-3,  2.2253401112E-3,  -4.9274001503E-4,  -6.3222697936E-3,  -2.7556000277E-3,  5.3632198833E-3,
            	 7.3032598011E-3,  5.3632198833E-3,  -2.7556000277E-3,  -6.3222697936E-3,  -4.9274001503E-4,  2.2253401112E-3,  2.1750701126E-3,  1.5450799838E-3},
            	{1.9235999789E-3,  2.5626500137E-3,  2.1145299543E-3,  -3.1295299996E-3,  -2.7556000277E-3,  1.3962360099E-2,  7.8046298586E-3,
            	 -9.3812197447E-3,  7.8046298586E-3,  1.3962360099E-2,  -2.7556000277E-3,  -3.1295299996E-3,  2.1145299543E-3,  2.5626500137E-3,  1.9235999789E-3},
            	{2.0687500946E-3,  2.2892199922E-3,  3.3578000148E-4,  -4.5751798898E-3,  5.3632198833E-3,  7.8046298586E-3,  -7.9501636326E-2,
            	 -0.1554141641,    -7.9501636326E-2,  7.8046298586E-3,  5.3632198833E-3,  -4.5751798898E-3,  3.3578000148E-4,  2.2892199922E-3,  2.0687500946E-3},
            	{2.0898699295E-3,  1.9755100366E-3,  -8.3368999185E-4,  -5.1014497876E-3,  7.3032598011E-3,  -9.3812197447E-3,  -0.1554141641,
            	 0.7303866148,   -0.1554141641,      -9.3812197447E-3,  7.3032598011E-3,  -5.1014497876E-3,  -8.3368999185E-4,  1.9755100366E-3,  2.0898699295E-3},
            	{2.0687500946E-3,  2.2892199922E-3,  3.3578000148E-4,  -4.5751798898E-3,  5.3632198833E-3,  7.8046298586E-3,  -7.9501636326E-2, 
            	 -0.1554141641,   -7.9501636326E-2,  7.8046298586E-3,  5.3632198833E-3,  -4.5751798898E-3,  3.3578000148E-4,  2.2892199922E-3,  2.0687500946E-3},
            	{1.9235999789E-3,  2.5626500137E-3,  2.1145299543E-3,  -3.1295299996E-3,  -2.7556000277E-3,  1.3962360099E-2,  7.8046298586E-3,
                 -9.3812197447E-3,  7.8046298586E-3,  1.3962360099E-2,  -2.7556000277E-3,  -3.1295299996E-3,  2.1145299543E-3,  2.5626500137E-3,  1.9235999789E-3},
            	{1.5450799838E-3,  2.1750701126E-3,  2.2253401112E-3,  -4.9274001503E-4,  -6.3222697936E-3,  -2.7556000277E-3,  5.3632198833E-3,
                 7.3032598011E-3,  5.3632198833E-3,  -2.7556000277E-3,  -6.3222697936E-3,  -4.9274001503E-4,  2.2253401112E-3,  2.1750701126E-3,  1.5450799838E-3},
            	{8.8387000142E-4,  1.5874400269E-3,  1.4050999889E-3,  1.2960999738E-3,  -4.9274001503E-4,  -3.1295299996E-3,  -4.5751798898E-3,
                -5.1014497876E-3,  -4.5751798898E-3,  -3.1295299996E-3,  -4.9274001503E-4,  1.2960999738E-3,  1.4050999889E-3,  1.5874400269E-3,  8.8387000142E-4},
            	{-3.7829999201E-5,  7.7435001731E-4,  1.1793200392E-3,  1.4050999889E-3,  2.2253401112E-3,  2.1145299543E-3,  3.3578000148E-4,
                 -8.3368999185E-4,  3.3578000148E-4,  2.1145299543E-3,  2.2253401112E-3,  1.4050999889E-3,  1.1793200392E-3,  7.7435001731E-4,  -3.7829999201E-5},
            	{-6.2596000498E-4,  -3.2734998967E-4,  7.7435001731E-4,  1.5874400269E-3,  2.1750701126E-3,  2.5626500137E-3,  2.2892199922E-3,
                 1.9755100366E-3,  2.2892199922E-3,  2.5626500137E-3,  2.1750701126E-3,  1.5874400269E-3,  7.7435001731E-4,  -3.2734998967E-4,  -6.2596000498E-4},
            	{-4.0483998600E-4,  -6.2596000498E-4,  -3.7829999201E-5,  8.8387000142E-4,  1.5450799838E-3,  1.9235999789E-3,  2.0687500946E-3,
                  2.0898699295E-3,  2.0687500946E-3,  1.9235999789E-3,  1.5450799838E-3,  8.8387000142E-4,  -3.7829999201E-5,  -6.2596000498E-4,  -4.0483998600E-4}};

            	lo0filt = new double[][] {
            	{-8.7009997515E-5,  -1.3542800443E-3,  -1.6012600390E-3,  -5.0337001448E-4,  2.5240099058E-3,
            		-5.0337001448E-4,  -1.6012600390E-3,  -1.3542800443E-3,  -8.7009997515E-5},
            	{-1.3542800443E-3,  2.9215801042E-3,  7.5227199122E-3,  8.2244202495E-3,  1.1076199589E-3,
            		8.2244202495E-3,  7.5227199122E-3,  2.9215801042E-3,  -1.3542800443E-3},
            	{-1.6012600390E-3,  7.5227199122E-3,  -7.0612900890E-3,  -3.7694871426E-2,  -3.2971370965E-2,
            		-3.7694871426E-2,  -7.0612900890E-3,  7.5227199122E-3,  -1.6012600390E-3},
            	{-5.0337001448E-4,  8.2244202495E-3,  -3.7694871426E-2,  4.3813198805E-2,  0.1811603010,
            		4.3813198805E-2,  -3.7694871426E-2,  8.2244202495E-3,  -5.0337001448E-4},
            	{2.5240099058E-3,  1.1076199589E-3,  -3.2971370965E-2,  0.1811603010,      0.4376249909,
            		0.1811603010,      -3.2971370965E-2,  1.1076199589E-3,  2.5240099058E-3},
            	{-5.0337001448E-4,  8.2244202495E-3,  -3.7694871426E-2,  4.3813198805E-2,  0.1811603010,
            		4.3813198805E-2,  -3.7694871426E-2,  8.2244202495E-3,  -5.0337001448E-4},
            	{-1.6012600390E-3,  7.5227199122E-3,  -7.0612900890E-3,  -3.7694871426E-2,  -3.2971370965E-2,
            		-3.7694871426E-2,  -7.0612900890E-3,  7.5227199122E-3,  -1.6012600390E-3},
            	{-1.3542800443E-3,  2.9215801042E-3,  7.5227199122E-3,  8.2244202495E-3,  1.1076199589E-3,
            		8.2244202495E-3,  7.5227199122E-3,  2.9215801042E-3,  -1.3542800443E-3},
            	{-8.7009997515E-5,  -1.3542800443E-3,  -1.6012600390E-3,  -5.0337001448E-4,  2.5240099058E-3,
            		-5.0337001448E-4,  -1.6012600390E-3,  -1.3542800443E-3,  -8.7009997515E-5}};

            	lofilt = new double[][] {
            	{-4.3500000174E-5,  1.2078000145E-4,  -6.7714002216E-4,  -1.2434000382E-4,  -8.0063997302E-4,  -1.5970399836E-3,
            		-2.5168000138E-4,  -4.2019999819E-4,  1.2619999470E-3,  -4.2019999819E-4,  -2.5168000138E-4,  -1.5970399836E-3,
            		-8.0063997302E-4,  -1.2434000382E-4,  -6.7714002216E-4,  1.2078000145E-4,  -4.3500000174E-5},
            	{1.2078000145E-4,  4.4606000301E-4,  -5.8146001538E-4,  5.6215998484E-4,  -1.3688000035E-4,  2.3255399428E-3,
            		2.8898599558E-3,  4.2872801423E-3,  5.5893999524E-3,  4.2872801423E-3,  2.8898599558E-3,  2.3255399428E-3,
            		-1.3688000035E-4,  5.6215998484E-4,  -5.8146001538E-4,  4.4606000301E-4,  1.2078000145E-4},
            	{-6.7714002216E-4,  -5.8146001538E-4,  1.4607800404E-3,  2.1605400834E-3,  3.7613599561E-3,  3.0809799209E-3,
            		4.1121998802E-3,  2.2212199401E-3,  5.5381999118E-4,  2.2212199401E-3,  4.1121998802E-3,  3.0809799209E-3,
            		3.7613599561E-3,  2.1605400834E-3,  1.4607800404E-3,  -5.8146001538E-4,  -6.7714002216E-4},
            	{-1.2434000382E-4,  5.6215998484E-4,  2.1605400834E-3,  3.1757799443E-3,  3.1846798956E-3,  -1.7774800071E-3,
            		-7.4316998944E-3,  -9.0569201857E-3,  -9.6372198313E-3,  -9.0569201857E-3,  -7.4316998944E-3,  -1.7774800071E-3,
            		3.1846798956E-3,  3.1757799443E-3,  2.1605400834E-3,  5.6215998484E-4,  -1.2434000382E-4},
            	{-8.0063997302E-4,  -1.3688000035E-4,  3.7613599561E-3,  3.1846798956E-3,  -3.5306399222E-3,  -1.2604200281E-2,
            		-1.8847439438E-2,  -1.7508180812E-2,  -1.6485679895E-2,  -1.7508180812E-2,  -1.8847439438E-2,  -1.2604200281E-2,
            		-3.5306399222E-3,  3.1846798956E-3,  3.7613599561E-3,  -1.3688000035E-4,  -8.0063997302E-4},
            	{-1.5970399836E-3,  2.3255399428E-3,  3.0809799209E-3,  -1.7774800071E-3,  -1.2604200281E-2,  -2.0229380578E-2,
            		-1.1091699824E-2,  3.9556599222E-3,  1.4385120012E-2,  3.9556599222E-3,  -1.1091699824E-2,  -2.0229380578E-2,
            		-1.2604200281E-2,  -1.7774800071E-3,  3.0809799209E-3,  2.3255399428E-3,  -1.5970399836E-3},
            	{-2.5168000138E-4,  2.8898599558E-3,  4.1121998802E-3,  -7.4316998944E-3,  -1.8847439438E-2,  -1.1091699824E-2,
            		2.1906599402E-2,  6.8065837026E-2,  9.0580143034E-2,  6.8065837026E-2,  2.1906599402E-2,  -1.1091699824E-2,
            		-1.8847439438E-2,  -7.4316998944E-3,  4.1121998802E-3,  2.8898599558E-3,  -2.5168000138E-4},
            	{-4.2019999819E-4,  4.2872801423E-3,  2.2212199401E-3,  -9.0569201857E-3,  -1.7508180812E-2,  3.9556599222E-3,
            		6.8065837026E-2,  0.1445499808,      0.1773651242,      0.1445499808,      6.8065837026E-2,  3.9556599222E-3,
            		-1.7508180812E-2,  -9.0569201857E-3,  2.2212199401E-3,  4.2872801423E-3,  -4.2019999819E-4},
            	{1.2619999470E-3,  5.5893999524E-3,  5.5381999118E-4,  -9.6372198313E-3,  -1.6485679895E-2,  1.4385120012E-2,
            		9.0580143034E-2,  0.1773651242,      0.2120374441,      0.1773651242,      9.0580143034E-2,  1.4385120012E-2,
            		-1.6485679895E-2,  -9.6372198313E-3,  5.5381999118E-4,  5.5893999524E-3,  1.2619999470E-3},
            	{-4.2019999819E-4,  4.2872801423E-3,  2.2212199401E-3,  -9.0569201857E-3,  -1.7508180812E-2,  3.9556599222E-3,
            		6.8065837026E-2,  0.1445499808,      0.1773651242,      0.1445499808,      6.8065837026E-2,  3.9556599222E-3,
            		-1.7508180812E-2,  -9.0569201857E-3,  2.2212199401E-3,  4.2872801423E-3,  -4.2019999819E-4},
            	{-2.5168000138E-4,  2.8898599558E-3,  4.1121998802E-3,  -7.4316998944E-3,  -1.8847439438E-2,  -1.1091699824E-2,
            		2.1906599402E-2,  6.8065837026E-2,  9.0580143034E-2,  6.8065837026E-2,  2.1906599402E-2,  -1.1091699824E-2,
            		-1.8847439438E-2,  -7.4316998944E-3,  4.1121998802E-3,  2.8898599558E-3,  -2.5168000138E-4},
            	{-1.5970399836E-3,  2.3255399428E-3,  3.0809799209E-3,  -1.7774800071E-3,  -1.2604200281E-2,  -2.0229380578E-2,
            		-1.1091699824E-2,  3.9556599222E-3,  1.4385120012E-2,  3.9556599222E-3,  -1.1091699824E-2,  -2.0229380578E-2,
            		-1.2604200281E-2,  -1.7774800071E-3,  3.0809799209E-3,  2.3255399428E-3,  -1.5970399836E-3},
            	{-8.0063997302E-4,  -1.3688000035E-4,  3.7613599561E-3,  3.1846798956E-3,  -3.5306399222E-3,  -1.2604200281E-2,
            		-1.8847439438E-2,  -1.7508180812E-2,  -1.6485679895E-2,  -1.7508180812E-2,  -1.8847439438E-2,  -1.2604200281E-2,
            		-3.5306399222E-3,  3.1846798956E-3,  3.7613599561E-3,  -1.3688000035E-4,  -8.0063997302E-4},
            	{-1.2434000382E-4,  5.6215998484E-4,  2.1605400834E-3,  3.1757799443E-3,  3.1846798956E-3,  -1.7774800071E-3,
            		-7.4316998944E-3,  -9.0569201857E-3,  -9.6372198313E-3,  -9.0569201857E-3,  -7.4316998944E-3,  -1.7774800071E-3,
            		3.1846798956E-3,  3.1757799443E-3,  2.1605400834E-3,  5.6215998484E-4,  -1.2434000382E-4},
            	{-6.7714002216E-4,  -5.8146001538E-4,  1.4607800404E-3,  2.1605400834E-3,  3.7613599561E-3,  3.0809799209E-3,
            		4.1121998802E-3,  2.2212199401E-3,  5.5381999118E-4,  2.2212199401E-3,  4.1121998802E-3,  3.0809799209E-3,
            		3.7613599561E-3,  2.1605400834E-3,  1.4607800404E-3,  -5.8146001538E-4,  -6.7714002216E-4},
            	{1.2078000145E-4,  4.4606000301E-4,  -5.8146001538E-4,  5.6215998484E-4,  -1.3688000035E-4,  2.3255399428E-3,
            		2.8898599558E-3,  4.2872801423E-3,  5.5893999524E-3,  4.2872801423E-3,  2.8898599558E-3,  2.3255399428E-3,
            		-1.3688000035E-4,  5.6215998484E-4,  -5.8146001538E-4,  4.4606000301E-4,  1.2078000145E-4},
            	{-4.3500000174E-5,  1.2078000145E-4,  -6.7714002216E-4,  -1.2434000382E-4,  -8.0063997302E-4,  -1.5970399836E-3,
            		-2.5168000138E-4,  -4.2019999819E-4,  1.2619999470E-3,  -4.2019999819E-4,  -2.5168000138E-4,  -1.5970399836E-3,
            		-8.0063997302E-4,  -1.2434000382E-4,  -6.7714002216E-4,  1.2078000145E-4,  -4.3500000174E-5}};

            	bfiltstranspose = new double[][] {
            	{-8.1125000725E-4,  4.4451598078E-3,  1.2316980399E-2,  1.3955879956E-2,  1.4179450460E-2,
            		1.3955879956E-2,  1.2316980399E-2,  4.4451598078E-3,  -8.1125000725E-4,
            	3.9103501476E-3,  4.4565401040E-3,  -5.8724298142E-3,  -2.8760801069E-3,  8.5267601535E-3,
            	    -2.8760801069E-3,  -5.8724298142E-3,  4.4565401040E-3,  3.9103501476E-3,
            	1.3462699717E-3,  -3.7740699481E-3,  8.2581602037E-3,  3.9442278445E-2,  5.3605638444E-2,
            	    3.9442278445E-2,  8.2581602037E-3,  -3.7740699481E-3,  1.3462699717E-3,
            	7.4700999539E-4,  -3.6522001028E-4,  -2.2522680461E-2,  -0.1105690673,      -0.1768419296,
            	    -0.1105690673,      -2.2522680461E-2,  -3.6522001028E-4,  7.4700999539E-4,
            	0.0000000000,      0.0000000000,      0.0000000000,      0.0000000000,      0.0000000000,
            	    0.0000000000,      0.0000000000,      0.0000000000,      0.0000000000,
            	-7.4700999539E-4,  3.6522001028E-4,  2.2522680461E-2,  0.1105690673,      0.1768419296,
            	    0.1105690673,      2.2522680461E-2,  3.6522001028E-4,  -7.4700999539E-4,
            	-1.3462699717E-3,  3.7740699481E-3,  -8.2581602037E-3,  -3.9442278445E-2,  -5.3605638444E-2,
            	    -3.9442278445E-2,  -8.2581602037E-3,  3.7740699481E-3,  -1.3462699717E-3,
            	-3.9103501476E-3,  -4.4565401040E-3,  5.8724298142E-3,  2.8760801069E-3,  -8.5267601535E-3,
            	    2.8760801069E-3,  5.8724298142E-3,  -4.4565401040E-3,  -3.9103501476E-3,
            	8.1125000725E-4,  -4.4451598078E-3,  -1.2316980399E-2,  -1.3955879956E-2,  -1.4179450460E-2,
            	    -1.3955879956E-2,  -1.2316980399E-2,  -4.4451598078E-3,  8.1125000725E-4},
            
            	{0.0000000000,      -8.2846998703E-4,  -5.7109999034E-5,  4.0110000555E-5,  4.6670897864E-3,
            	    8.0871898681E-3,  1.4807609841E-2,  8.6204400286E-3,  -3.1221499667E-3,
            	8.2846998703E-4,  0.0000000000,      -9.7479997203E-4,  -6.9718998857E-3,  -2.0865600090E-3,
            	    2.3298799060E-3,  -4.4814897701E-3,  1.4917500317E-2,  8.6204400286E-3,
            	5.7109999034E-5,  9.7479997203E-4,  0.0000000000,      -1.2145539746E-2,  -2.4427289143E-2,
            	    5.0797060132E-2,  3.2785870135E-2,  -4.4814897701E-3,  1.4807609841E-2,
            	-4.0110000555E-5,  6.9718998857E-3,  1.2145539746E-2,  0.0000000000,      -0.1510555595,
            	    -8.2495503128E-2,  5.0797060132E-2,  2.3298799060E-3,  8.0871898681E-3,
            	-4.6670897864E-3,  2.0865600090E-3,  2.4427289143E-2,  0.1510555595,      0.0000000000,
            	    -0.1510555595,      -2.4427289143E-2,  -2.0865600090E-3,  4.6670897864E-3,
            	-8.0871898681E-3,  -2.3298799060E-3,  -5.0797060132E-2,  8.2495503128E-2,  0.1510555595,
            	    0.0000000000,      -1.2145539746E-2,  -6.9718998857E-3,  4.0110000555E-5,
            	-1.4807609841E-2,  4.4814897701E-3,  -3.2785870135E-2,  -5.0797060132E-2,  2.4427289143E-2,
            	    1.2145539746E-2,  0.0000000000,      -9.7479997203E-4,  -5.7109999034E-5,
            	-8.6204400286E-3,  -1.4917500317E-2,  4.4814897701E-3,  -2.3298799060E-3,  2.0865600090E-3,
            	    6.9718998857E-3,  9.7479997203E-4,  0.0000000000,      -8.2846998703E-4,
            	3.1221499667E-3,  -8.6204400286E-3,  -1.4807609841E-2,  -8.0871898681E-3,  -4.6670897864E-3,
            	    -4.0110000555E-5,  5.7109999034E-5,  8.2846998703E-4,  0.0000000000},
            	
            	{8.1125000725E-4,  -3.9103501476E-3,  -1.3462699717E-3,  -7.4700999539E-4,  0.0000000000,
            	    7.4700999539E-4,  1.3462699717E-3,  3.9103501476E-3,  -8.1125000725E-4,
            	-4.4451598078E-3,  -4.4565401040E-3,  3.7740699481E-3,  3.6522001028E-4,  0.0000000000,
            	    -3.6522001028E-4,  -3.7740699481E-3,  4.4565401040E-3,  4.4451598078E-3,
            	-1.2316980399E-2,  5.8724298142E-3,  -8.2581602037E-3,  2.2522680461E-2,  0.0000000000,
            	    -2.2522680461E-2,  8.2581602037E-3,  -5.8724298142E-3,  1.2316980399E-2,
            	-1.3955879956E-2,  2.8760801069E-3,  -3.9442278445E-2,  0.1105690673,      0.0000000000,
            	    -0.1105690673,      3.9442278445E-2,  -2.8760801069E-3,  1.3955879956E-2,
            	-1.4179450460E-2,  -8.5267601535E-3,  -5.3605638444E-2,  0.1768419296,      0.0000000000,
            	    -0.1768419296,     5.3605638444E-2,  8.5267601535E-3,  1.4179450460E-2,
            	-1.3955879956E-2,  2.8760801069E-3,  -3.9442278445E-2,  0.1105690673,      0.0000000000,
            	    -0.1105690673,      3.9442278445E-2,  -2.8760801069E-3,  1.3955879956E-2,
            	-1.2316980399E-2,  5.8724298142E-3,  -8.2581602037E-3,  2.2522680461E-2,  0.0000000000,
            	    -2.2522680461E-2,  8.2581602037E-3,  -5.8724298142E-3,  1.2316980399E-2,
            	-4.4451598078E-3,  -4.4565401040E-3,  3.7740699481E-3,  3.6522001028E-4,  0.0000000000,
            	    -3.6522001028E-4,  -3.7740699481E-3,  4.4565401040E-3,  4.4451598078E-3,
            	8.1125000725E-4,  -3.9103501476E-3,  -1.3462699717E-3,  -7.4700999539E-4,  0.0000000000,
            	    7.4700999539E-4,  1.3462699717E-3,  3.9103501476E-3,  -8.1125000725E-4},
            	
            	{3.1221499667E-3,  -8.6204400286E-3,  -1.4807609841E-2,  -8.0871898681E-3,  -4.6670897864E-3,
            	    -4.0110000555E-5,  5.7109999034E-5,  8.2846998703E-4,  0.0000000000,
            	-8.6204400286E-3,  -1.4917500317E-2,  4.4814897701E-3,  -2.3298799060E-3,  2.0865600090E-3,
            	    6.9718998857E-3,  9.7479997203E-4,  -0.0000000000,      -8.2846998703E-4,
            	-1.4807609841E-2,  4.4814897701E-3,  -3.2785870135E-2,  -5.0797060132E-2,  2.4427289143E-2,
            	    1.2145539746E-2,  0.0000000000,      -9.7479997203E-4,  -5.7109999034E-5,
            	-8.0871898681E-3,  -2.3298799060E-3,  -5.0797060132E-2,  8.2495503128E-2,  0.1510555595,
            	    -0.0000000000,      -1.2145539746E-2,  -6.9718998857E-3,  4.0110000555E-5,
            	-4.6670897864E-3,  2.0865600090E-3,  2.4427289143E-2,  0.1510555595,      0.0000000000,
            	    -0.1510555595,      -2.4427289143E-2,  -2.0865600090E-3,  4.6670897864E-3,
            	-4.0110000555E-5,  6.9718998857E-3,  1.2145539746E-2,  0.0000000000,      -0.1510555595,
            	    -8.2495503128E-2,  5.0797060132E-2,  2.3298799060E-3,  8.0871898681E-3,
            	5.7109999034E-5,  9.7479997203E-4,  -0.0000000000,      -1.2145539746E-2,  -2.4427289143E-2,
            	    5.0797060132E-2,  3.2785870135E-2,  -4.4814897701E-3,  1.4807609841E-2,
            	8.2846998703E-4,  -0.0000000000,      -9.7479997203E-4,  -6.9718998857E-3,  -2.0865600090E-3,
            	    2.3298799060E-3,  -4.4814897701E-3,  1.4917500317E-2,  8.6204400286E-3,
            	0.0000000000,      -8.2846998703E-4,  -5.7109999034E-5,  4.0110000555E-5,  4.6670897864E-3,
            	    8.0871898681E-3,  1.4807609841E-2,  8.6204400286E-3,  -3.1221499667E-3}};
        	    bfilts = new double[bfiltstranspose[0].length][bfiltstranspose.length];
				for (r = 0; r < bfilts.length; r++) {
					for (c = 0; c < bfilts[0].length; c++) {
						bfilts[r][c] = bfiltstranspose[c][r];
					}
				}
	
            }
            else if (filtfile.equalsIgnoreCase("sp5Filters")) {
				harmonics.add(new int[] {1, 3, 5});
	
			    steermtx.add(new double[][] {
				    {0.3333,    0.2887,    0.1667,    0.0000,   -0.1667,   -0.2887},
				    {0.0000,    0.1667,    0.2887,    0.3333,    0.2887,    0.1667},
				    {0.3333,   -0.0000,   -0.3333,   -0.0000,    0.3333,   -0.0000},
				    {0.0000,    0.3333,    0.0000,   -0.3333,    0.0000,    0.3333},
				    {0.3333,   -0.2887,    0.1667,   -0.0000,   -0.1667,    0.2887},
				   {-0.0000,    0.1667,   -0.2887,    0.3333,   -0.2887,    0.1667}});
	
				hi0filt = new double[][] { 
				{-0.00033429, -0.00113093, -0.00171484, -0.00133542, -0.00080639, -0.00133542, -0.00171484, -0.00113093, -0.00033429},
				{-0.00113093, -0.00350017, -0.00243812, 0.00631653, 0.01261227, 0.00631653, -0.00243812, -0.00350017, -0.00113093},
				{-0.00171484, -0.00243812, -0.00290081, -0.00673482, -0.00981051, -0.00673482, -0.00290081, -0.00243812, -0.00171484},
				{-0.00133542, 0.00631653, -0.00673482, -0.07027679, -0.11435863, -0.07027679, -0.00673482, 0.00631653, -0.00133542},
				{-0.00080639, 0.01261227, -0.00981051, -0.11435863, 0.81380200, -0.11435863, -0.00981051, 0.01261227, -0.00080639},
				{-0.00133542, 0.00631653, -0.00673482, -0.07027679, -0.11435863, -0.07027679, -0.00673482, 0.00631653, -0.00133542},
				{-0.00171484, -0.00243812, -0.00290081, -0.00673482, -0.00981051, -0.00673482, -0.00290081, -0.00243812, -0.00171484},
				{-0.00113093, -0.00350017, -0.00243812, 0.00631653, 0.01261227, 0.00631653, -0.00243812, -0.00350017, -0.00113093},
				{-0.00033429, -0.00113093, -0.00171484, -0.00133542, -0.00080639, -0.00133542, -0.00171484, -0.00113093, -0.00033429}};
	
	
				lo0filt = new double[][] {
				{0.00341614, -0.01551246, -0.03848215, -0.01551246, 0.00341614},
				{-0.01551246, 0.05586982, 0.15925570, 0.05586982, -0.01551246},
				{-0.03848215, 0.15925570, 0.40304148, 0.15925570, -0.03848215},
				{-0.01551246, 0.05586982, 0.15925570, 0.05586982, -0.01551246},
				{0.00341614, -0.01551246, -0.03848215, -0.01551246, 0.00341614}};
	
				lofilt = new double[][] {
				{0.00085404, -0.00244917, -0.00387812, -0.00944432, -0.00962054, -0.00944432, -0.00387812, -0.00244917, 0.00085404},
				{-0.00244917, -0.00523281, -0.00661117, 0.00410600, 0.01002988, 0.00410600, -0.00661117, -0.00523281, -0.00244917},
				{-0.00387812, -0.00661117, 0.01396746, 0.03277038, 0.03981393, 0.03277038, 0.01396746, -0.00661117, -0.00387812},
				{-0.00944432, 0.00410600, 0.03277038, 0.06426333, 0.08169618, 0.06426333, 0.03277038, 0.00410600, -0.00944432},
				{-0.00962054, 0.01002988, 0.03981393, 0.08169618, 0.10096540, 0.08169618, 0.03981393, 0.01002988, -0.00962054},
				{-0.00944432, 0.00410600, 0.03277038, 0.06426333, 0.08169618, 0.06426333, 0.03277038, 0.00410600, -0.00944432},
				{-0.00387812, -0.00661117, 0.01396746, 0.03277038, 0.03981393, 0.03277038, 0.01396746, -0.00661117, -0.00387812},
				{-0.00244917, -0.00523281, -0.00661117, 0.00410600, 0.01002988, 0.00410600, -0.00661117, -0.00523281, -0.00244917},
				{0.00085404, -0.00244917, -0.00387812, -0.00944432, -0.00962054, -0.00944432, -0.00387812, -0.00244917, 0.00085404}};
				for (r = 0; r < lofilt.length; r++) {
					for (c = 0; c < lofilt[0].length; c++) {
					    lofilt[r][c] = 2.0*lofilt[r][c];
					}
				}
	
				bfiltstranspose = new double[][] {
				 {0.00277643, 0.00496194, 0.01026699, 0.01455399, 0.01026699, 0.00496194, 0.00277643,
				-0.00986904, -0.00893064, 0.01189859, 0.02755155, 0.01189859, -0.00893064, -0.00986904,
				-0.01021852, -0.03075356, -0.08226445, -0.11732297, -0.08226445, -0.03075356, -0.01021852,
				 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000,
				 0.01021852, 0.03075356, 0.08226445, 0.11732297, 0.08226445, 0.03075356, 0.01021852,
				 0.00986904, 0.00893064, -0.01189859, -0.02755155, -0.01189859, 0.00893064, 0.00986904,
				-0.00277643, -0.00496194, -0.01026699, -0.01455399, -0.01026699, -0.00496194, -0.00277643},
				
				{-0.00343249, -0.00640815, -0.00073141, 0.01124321, 0.00182078, 0.00285723, 0.01166982,
				-0.00358461, -0.01977507, -0.04084211, -0.00228219, 0.03930573, 0.01161195, 0.00128000,
				 0.01047717, 0.01486305, -0.04819057, -0.12227230, -0.05394139, 0.00853965, -0.00459034,
				 0.00790407, 0.04435647, 0.09454202, -0.00000000, -0.09454202, -0.04435647, -0.00790407,
				 0.00459034, -0.00853965, 0.05394139, 0.12227230, 0.04819057, -0.01486305, -0.01047717,
				-0.00128000, -0.01161195, -0.03930573, 0.00228219, 0.04084211, 0.01977507, 0.00358461,
				-0.01166982, -0.00285723, -0.00182078, -0.01124321, 0.00073141, 0.00640815, 0.00343249},
			
				 {0.00343249, 0.00358461, -0.01047717, -0.00790407, -0.00459034, 0.00128000, 0.01166982,
				 0.00640815, 0.01977507, -0.01486305, -0.04435647, 0.00853965, 0.01161195, 0.00285723,
				 0.00073141, 0.04084211, 0.04819057, -0.09454202, -0.05394139, 0.03930573, 0.00182078,
				-0.01124321, 0.00228219, 0.12227230, -0.00000000, -0.12227230, -0.00228219, 0.01124321,
				-0.00182078, -0.03930573, 0.05394139, 0.09454202, -0.04819057, -0.04084211, -0.00073141,
				-0.00285723, -0.01161195, -0.00853965, 0.04435647, 0.01486305, -0.01977507, -0.00640815,
				-0.01166982, -0.00128000, 0.00459034, 0.00790407, 0.01047717, -0.00358461, -0.00343249},
				
				{-0.00277643, 0.00986904, 0.01021852, -0.00000000, -0.01021852, -0.00986904, 0.00277643,
				-0.00496194, 0.00893064, 0.03075356, -0.00000000, -0.03075356, -0.00893064, 0.00496194,
				-0.01026699, -0.01189859, 0.08226445, -0.00000000, -0.08226445, 0.01189859, 0.01026699,
				-0.01455399, -0.02755155, 0.11732297, -0.00000000, -0.11732297, 0.02755155, 0.01455399,
				-0.01026699, -0.01189859, 0.08226445, -0.00000000, -0.08226445, 0.01189859, 0.01026699,
				-0.00496194, 0.00893064, 0.03075356, -0.00000000, -0.03075356, -0.00893064, 0.00496194,
				-0.00277643, 0.00986904, 0.01021852, -0.00000000, -0.01021852, -0.00986904, 0.00277643},
			
				{-0.01166982, -0.00128000, 0.00459034, 0.00790407, 0.01047717, -0.00358461, -0.00343249,
				-0.00285723, -0.01161195, -0.00853965, 0.04435647, 0.01486305, -0.01977507, -0.00640815,
				-0.00182078, -0.03930573, 0.05394139, 0.09454202, -0.04819057, -0.04084211, -0.00073141,
				-0.01124321, 0.00228219, 0.12227230, -0.00000000, -0.12227230, -0.00228219, 0.01124321,
				 0.00073141, 0.04084211, 0.04819057, -0.09454202, -0.05394139, 0.03930573, 0.00182078,
				 0.00640815, 0.01977507, -0.01486305, -0.04435647, 0.00853965, 0.01161195, 0.00285723,
				 0.00343249, 0.00358461, -0.01047717, -0.00790407, -0.00459034, 0.00128000, 0.01166982},
			
				{-0.01166982, -0.00285723, -0.00182078, -0.01124321, 0.00073141, 0.00640815, 0.00343249,
				-0.00128000, -0.01161195, -0.03930573, 0.00228219, 0.04084211, 0.01977507, 0.00358461,
				 0.00459034, -0.00853965, 0.05394139, 0.12227230, 0.04819057, -0.01486305, -0.01047717,
				 0.00790407, 0.04435647, 0.09454202, -0.00000000, -0.09454202, -0.04435647, -0.00790407,
				 0.01047717, 0.01486305, -0.04819057, -0.12227230, -0.05394139, 0.00853965, -0.00459034,
				-0.00358461, -0.01977507, -0.04084211, -0.00228219, 0.03930573, 0.01161195, 0.00128000,
				-0.00343249, -0.00640815, -0.00073141, 0.01124321, 0.00182078, 0.00285723, 0.01166982}};
				bfilts = new double[bfiltstranspose[0].length][bfiltstranspose.length];
				for (r = 0; r < bfilts.length; r++) {
					for (c = 0; c < bfilts[0].length; c++) {
						bfilts[r][c] = bfiltstranspose[c][r];
					}
				}
		
			} // if (filtfile.equalsIgnoreCase("sp5Filters"))
			else {
			  System.err.println("Use buildSFpyr for pyramids with arbitrary numbers of orientation bands");
			  System.err.println("filtfile argument must be the name of an M-file containing SPYR filters.");
			  return;
			}
	
			int max_ht = maxPyrHt(im.length, im[0].length, lofilt.length);
			if (ht < 1) {
			  ht = max_ht;
			}
			else {
			  if (ht > max_ht) {
			    System.err.println("Cannot build pyramid higher than " + max_ht + " levels.");
			    return;
			  }
			}
	
			// -----------------------------------------------------------------
	
			/*hi0 = corrDn(im, hi0filt, edges);
			lo0 = corrDn(im, lo0filt, edges);
	
			[pyr,pind] = buildSpyrLevs(lo0, ht, lofilt, bfilts, edges);
	
			pyr = [hi0(:) ; pyr];
			pind = [size(hi0); pind];*/
		}
			  
		// HEIGHT = maxPyrHt(IMSIZE, FILTSIZE)
		
		// Compute maximum pyramid height for given image and filter sizes.
		// Specifically: the number of corrDn operations that can be sequentially
		// performed when subsampling by a factor of 2.

		// Eero Simoncelli, 6/96.

		private int maxPyrHt(int imszy, int imszx, int filtsz) {

			if ((imszy < filtsz) || (imszx < filtsz)) {
				return 0;
			}
			else {
				return (1 + maxPyrHt((int)Math.floor(imszy/2.0), (int)Math.floor(imszx/2.0), filtsz));
			}
		}

		

	
}